<!DOCTYPE html>

{% extends "layout.html" %}

<!-- API Key: AIzaSyDXAyOiMguoCfaShMK7_tYexWPqPkWmCoc -->
{% block content %}

<!-- Main Content -->
<div class="container mt-5">
    <h1>Welcome to EcoEats</h1>
    <p>Order your favorite eco-friendly meals today!</p>

    <div class="mapDiv">
        <form id="addressForm" name="address">
            <label for="address">Address</label>
            <input type="text" class="mb-3" id="address" name="address" placeholder="Enter address" required>
            <p id="autocompleteDropdown"></p>
        </form>

        <div id="map"></div>
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDXAyOiMguoCfaShMK7_tYexWPqPkWmCoc&libraries=places&callback=initAutocomplete"></script>
    <script>
        (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
            key: "AIzaSyDXAyOiMguoCfaShMK7_tYexWPqPkWmCoc",
            v: "weekly",
            // Use the 'v' parameter to indicate the version to use (weekly, beta, alpha, etc.).
            // Add other bootstrap parameters as needed, using camel case.
        });
    </script>

    <script>
        let map; 
        let autocomplete;
        let posMarker;

        async function initMap() {
            const { Map } = await google.maps.importLibrary("maps");

            map = new Map(document.getElementById("map"), {
                center: { lat: 39.80, lng: -98.5556199 },
                zoom: 4,
                mapTypeId: 'roadmap',
                zoomControl: true,
                mapTypeControl: false,
                scaleControl: false,
                streetViewControl: false,
                fullscreenControl: false
            });

            posMarker = new google.maps.Marker({
                map,
                anchorPoint: new google.maps.Point(0, -29),
            });
            posMarker.setVisible(false);
        }

        async function initAutocomplete() {
            autocomplete = new google.maps.places.Autocomplete(
                document.getElementById("address"),
                {
                    componentRestrictions: { country: "us" },
                    fields: ["address_components", "geometry", "icon", "name", "place_id"],
                }
            );

            autocomplete.addListener("place_changed", onPlaceChanged);

            console.log("intialized autocomplete");
        }

        function onPlaceChanged() {
            var place = autocomplete.getPlace();

            if (!place.geometry || !place.geometry.location) { // user did not select a prediction
                document.getElementById("address").placeholder = 'Enter a place';
                console.log("No details available for input: '" + place.name + "'");
                return;
            } 
            
            if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
            } else {
                document.getElementById("autocompleteDropdown").innerHTML = place.name;
                console.log(place.geometry);

                map.setCenter(place.geometry.location);
                map.setZoom(15);
            }

            posMarker.setPosition(place.geometry.location);
            posMarker.setVisible(true);
        }

        initMap();
        initAutocomplete();

    </script>


    <!-- Multi-stage form -->
    <form id="multi-stage-form">
        <section class="form-section active">
            <!-- Stage 1: Order -->
            <h2>Choose Your Order Items</h2>
            <div class="form-group">
                <label for="meal">Select an item</label>
                <select class="form-control" id="meal" name="meal" required>
                    <option value="meal1">nathan lu</option>
                    <option value="meal2">playboi parthy</option>
                    <option value="meal2">golem god</option>
                </select>
            </div>
            <button type="button" class="btn btn-primary next">Next</button>
        </section>

        <section class="form-section">
            <!-- Stage 2: Personal Info -->
            <h2>Personal Information</h2>
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="phone">Phone</label>
                <input type="tel" class="form-control" id="phone" name="phone" required>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="text" class="form-control" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="delivAddress">Delivery Address</label>
                <input type="text" class="form-control" id="delivAddress" name="delivAddress" required>
            </div>
            <button type="button" class="btn btn-primary prev">Previous</button>
            <button type="button" class="btn btn-primary next">Next</button>
        </section>

        <section class="form-section">
            <!-- Stage 3: Additional Information -->
            <h2>Additional Information</h2>
            <div class="form-group">
                <label for="special-requests">Special Requests:</label>
                <textarea class="form-control" id="special-requests" name="special-requests"></textarea>
            </div>
            <button type="button" class="btn btn-primary prev">Previous</button>
            <button type="button" class="btn btn-primary next">Next</button>
        </section>

        <section class="form-section">
            <!-- Stage 4: Confirmation -->
            <h2>Confirmation</h2>
            <p>Please review your order details:</p>
            <!-- Display order summary here -->

            <!-- Payment -->
            <div class="form-group">
                <label for="cardNumber">Credit Card Number</label>
                <input type="number" class="form-control" id="cardNumber" placeholder="Credit Card Number" name="cardNumber" required>
            </div>
            <div class="form-group">
                <label for="phone">CVV</label>
                <input type="number" class="form-control" id="cardCVV" name="cardCVV" required>
            </div>
            <div class="form-group">
                <label for="cardDate">MM/YY</label>
                <input type="text" class="form-control" id="cardDate" name="cardDate" required>
            </div>
            <div class="form-group">
                <label for="cardZip">Zip</label>
                <input type="number" class="form-control" id="cardZip" name="cardZip" required>
            </div>
            <div class="form-group">
                <label for="cardName">Cardholder Name</label>
                <input type="text" class="form-control" id="cardName" name="cardName" required>
            </div>

            <button type="button" class="btn btn-primary prev">Previous</button>
            <button type="submit" class="btn btn-success">Submit Order</button>
        </section>
    </form>
</div>


<!-- Custom JavaScript for the multi-stage form -->
<script>
    // JavaScript to handle multi-stage form navigation
    document.addEventListener("DOMContentLoaded", function () {
        const formSections = document.querySelectorAll(".form-section");
        const nextButtons = document.querySelectorAll(".next");
        const prevButtons = document.querySelectorAll(".prev");

        nextButtons.forEach((button, index) => {
            button.addEventListener("click", function () {
                formSections[index].classList.remove("active");
                formSections[index + 1].classList.add("active");
            });
        });

        prevButtons.forEach((button, index) => {
            button.addEventListener("click", function () {
                index = index + 1; // because the first section does not have a previous button
                formSections[index].classList.remove("active");
                formSections[index - 1].classList.add("active");
            });
        });
    });
</script>

<!-- Bootstrap JS and jQuery (for dropdowns) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

{% endblock %}
